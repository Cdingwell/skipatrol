<html>
	<head>
	<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
		<script>
		
		
		
			//Saves the (potentionally incomplete) current form
			function saveForm(title){
				var title = "0001";
				//Read through all of the form elements
				var form = document.getElementById("trill").elements;
				
				//Create new JSON Object to represent the form
				var json = {};
				
				//Get all of the values
				//Selects & textfields (they both go by id)
				var ids = ["id1", "id2"];
				for (var i = 0; i < ids.length; i++){
					var id = ids[i];
					var val = [document.getElementById(id).value];
					json[id] = val;
				}
				
				//Loop through the checkboxes
				var names = ["name1"];
				for (var i = 0; i < names.length; i++){
					var name = names[i];
					var group = document.getElementsByName(name);
					
					//New array that will hold the ids of all of the checkboxes that are selected
					var selections = new Array();
					
					for (var t = 0; t < group.length; t++){
						if (group[t].checked){
							selections.push(group[t].id);
						}
					}
					json[name] = selections;
				}
				
				//Put into local storage
				localStorage[title] = JSON.stringify(json);
			}
			
			
			
			//Validates one form
			function validateForm(name){
				//Get JSON from local storage
				var json = JSON.parse(localStorage[name]);
				
				//Check to see that each value of the json object has a value
				for (var key in json) {
  					if (json.hasOwnProperty(key)) {
    					console.log(json[key]);
    					if (json[key].length < 1 || json[key][0]===""){
    						//Return false if there was an 
    						return false;
    					}
    				}
				}
				//If we've gotten here, the form is valid
				return true;
			}
			
			
			
			
			//Syncs one form
			function sync(name){
				var json = localStorage[name];
				console.log(json);
				$.post("http://0407stats.com/php/insertIntoDB.php", 
						{data: json}, 
						function(data){
							console.log(data);
							if(data.response){
								console.log(name+" was sucesfully sent to DB, removing it from local storage.");
								//localStorage.removeItem(name);
						}
						else{
							console.log(name+" was not submitted to the DB.");
						}
				});
			}
			
			
			function main(){
				//Loop through all keys and try to validate the corresponding json object and sync it
				var localStorageKeys = Object.keys(localStorage);
				for (var i = 0; i < localStorageKeys.length; i++){
					if (validateForm(localStorageKeys[i])){
						sync(localStorageKeys[i]);
					}
					else{
						console.log(localStorageKeys[i]+" didn't validate.");
					}
				}
			}
			
				
		</script>
	</head>

	<body>
		<h1>PAGE 2</h1>
		<a href="storage.html">Page 1</a>
		<form id="trill">
			First name: <input id="id1" type="text" name="firstname"><br><br>
			<select id="id2">
  				<option value="volvo">Volvo</option>
  				<option value="saab">Saab</option>
			</select><br>
			
			<input type="checkbox" id="c1" name="name1" value="Bike">I have a bike<br>
			<input type="checkbox" id="c2" name="name1" value="Car">I have a car<br><br>
		</form>
		<button type="button" onclick="saveForm();">Save<br><br>
		<button type="button" onclick="main();">Show<br><br>
	</body>
	
</html>